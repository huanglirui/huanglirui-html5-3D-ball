<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>3D</title>
  <link href="css/index.css" rel="stylesheet" />
 </head>
 <body>
	<!--用户操作提示-->
	<div class="intrduce">
		<p>鼠标滚轮可以控制球的大小</p>
		<p>鼠标点击可以控制球转动的方向</p>
		<p>鼠标点击链接可以查看简历详细信息</p>
	</div>
	<!--温馨提示-->
	<div class="warning">
			<strong>温馨提示：亲,请使用高版本的浏览器预览(使用了很多html5+css3的技术)。否则就看不到3D球旋转了</strong>
		</div>
	<!--3D球场景-->
	<div id="scene">
		<div id="out">
			<!--3D球-->
			<ul id="ball">
				
			</ul>
		</div>
	</div>
<!--滚轮控制函数和拖拽旋转控制函数封装-->
<script type="text/javascript" src="js/tool.js"></script>
<!--设置css3属性函数的封装-->
<script type="text/javascript" src="js/css3.js"></script>
<!--生成球上各个点的位置的封装-->
<script type="text/javascript" src="js/drawBall.js"></script>
<script type="text/javascript">
window.onload = function  () {
	//以json格式为构造函数传入参数
	var Obj = {
		oScene:document.getElementById("scene"), 
		oOut:document.getElementById("out"),
		balls:document.getElementById("ball"),
		newBall:new drawBall(),  //new出一个画球的对象
		maths:new math()		//new出一个鼠标拖拽任意轴旋转的对象
	};

	function ThreeD (obj) {
		this.oScene = obj.oScene;
		this.oOut = obj.oOut;
		this.balls = obj.balls;
		this.newBall = obj.newBall;
		this.maths = obj.maths;
		this.arr = [];		 //存入球旋转时变化的参数
		this.timer = null;  
		this.startZ = -300;  //给3D场景距离屏幕一个初始变化的距离
		this.step = 2;       //球旋转的速度

		this.init();
	};
	
	ThreeD.prototype = {
		constructor:ThreeD,
		init:function  () {
			this.draw();     //画出球
			this.setInter();  //球旋转
			this.mouseControl();  //鼠标滚轮控制
			this.dragConrol();   //鼠标拖拽控制
			this.appendText();   //添加文字
		},
		draw:function  () {
			this.newBall.draw();
			for (var i=0,len=this.newBall.all.length; i<len; i++) {
				this.balls.appendChild(this.newBall.all[i]);  //在球上加入li
			};
		},
		setInter:function  () {
			var _this = this;
			this.timer = setInterval(function(){_this.moves(_this.step, 5, -1);}, 60);
		},
		moves:function (angle, x, y) {  //旋转的速度和绕（x, y）方向旋转
			if (angle>2) {
				angle *= 0.9;
			}else {
				angle = 2;	
			};
			this.maths.mouse = [x,y,0]
			this.maths.theta += angle;
			this.maths.rotates();
			this.arr = this.maths.arr;
			setCss3(this.balls, {transform:"matrix3d("+this.arr[0]+","+this.arr[1]+","+this.arr[2]+","+this.arr[3]+","+this.arr[4]+","+this.arr[5]+","+this.arr[6]+","+this.arr[7]+","+this.arr[8]+","+this.arr[9]+","+this.arr[10]+","+this.arr[11]+","+this.arr[12]+","+this.arr[13]+","+this.arr[14]+","+this.arr[15]+")"});
		},
		mouseControl:function  () {
			var _this = this;
			mouseScroll(this.oScene,function  () {
				_this.startZ += 20;
				setCss3(_this.oOut, {transform:"translateZ("+_this.startZ+"px)"});
			}, function  () {
				_this.startZ -= 20;
				setCss3(_this.oOut, {transform:"translateZ("+_this.startZ+"px)"});
			});
		},
		dragConrol:function  () {
			var _this = this;
			this.addEvent(this.oScene, "mousedown", function  (e) {
			clearInterval(_this.timer);
			var ev = e || window.event;
			ev.preventDefault();
			var ballX = 0;
			var ballY = 0;
			_this.addEvent(document, "mousemove", move);
			_this.addEvent(document, "mouseup", up);
			function  move(e) {
				var ev = e || window.event;
				//鼠标到球中心的距离
				ballX = ev.clientX-_this.oScene.offsetLeft-250;
				ballY = ev.clientY-_this.oScene.offsetTop-250;
				//传入鼠标相对于球中心的坐标
				_this.moves(_this.step, ballX, ballY);
			};
			function  up() {
				_this.removeEvent(document, "mousemove", move);
				_this.removeEvent(document, "mouseup", up);
				//鼠标抬起，回复起始的速度
				_this.timer = setInterval(function(){_this.moves(_this.step, ballX, ballY);}, 60);
			};
		  });
		},
		appendText:function  () {
			var oLi = document.getElementsByTagName("li");
			var arrText = ["基本信息", "姓名", "年龄", "学历", "职业技能", "教育背景", "自我介绍"];
			for (var i=0,len=oLi.length; i<len; i++) {
				oLi[i].innerHTML = "<a href='../网页版实习简历/huanglirui.html'>"+arrText[i%7]+"</a>";
			};
		},
		//现代事件绑定和移除
		addEvent:function (obj, type, fn) {
			return document.addEventListener?obj.addEventListener(type, fn, false):
			obj.attachEvent("on"+type, fn);
		},
		removeEvent:function(obj, type, fn) {
			return document.removeEventListener?obj.removeEventListener(type, fn, false):
			obj.detachEvent("on"+type, fn);;
		}

	};
	//实例化
	var o = new ThreeD(Obj);

			
};
	</script>
 </body>
</html>
